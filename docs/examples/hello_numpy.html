<!--
# Copyright (c) 2020, NVIDIA CORPORATION. All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
#  * Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
#  * Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
#  * Neither the name of NVIDIA CORPORATION nor the names of its
#    contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY
# EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
# PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
# CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
# EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
# PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
# PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
# OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Quickstart (Numpy) &mdash; NVFlare 1.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/additions.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Quickstart (TensorFlow 2)" href="hello_tf2.html" />
    <link rel="prev" title="Quickstart (PyTorch)" href="hello_pt.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
           

          
            <a href="../index.html" class="icon icon-home"> NVFlare
          

          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #76b900;
    }

    .wy-side-nav-search a:link, .wy-nav-top a:link {
      color: #fff;
    }
    .wy-side-nav-search a:visited, .wy-nav-top a:visited {
      color: #fff;
    }
    .wy-side-nav-search a:hover, .wy-nav-top a:hover {
      color: #fff;
    }

    .wy-menu-vertical a:link, .wy-menu-vertical a:visited {
      color: #d9d9d9
    }

    .wy-menu-vertical a:active {
      background-color: #76b900
    }

    .wy-side-nav-search>div.version {
      color: rgba(0, 0, 0, 0.3)
    }

    .wy-nav-content {
      max-width: 80%;
    }

    .floatleftcol {
      float: left;
      max-width: 60%;
      padding-right: 20px;
    }
  </style>
  
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../quickstart.html">Quickstart</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="hello_pt.html">Quickstart (PyTorch)</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Quickstart (Numpy)</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#before-you-start">Before You Start</a></li>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nvflare-client">NVFlare Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="#nvflare-server-application">NVFlare Server &amp; Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#model-persistor">Model Persistor</a></li>
<li class="toctree-l4"><a class="reference internal" href="#application-configuration">Application Configuration</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#federated-numpy-fibonacci">Federated Numpy Fibonacci!</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#setting-up-the-application-environment">Setting Up the Application Environment</a></li>
<li class="toctree-l4"><a class="reference internal" href="#running-the-fl">Running the FL</a></li>
<li class="toctree-l4"><a class="reference internal" href="#understanding-the-output">Understanding the Output</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="hello_tf2.html">Quickstart (TensorFlow 2)</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide.html">User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programming_guide.html">Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apidocs/modules.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NVFlare</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../quickstart.html">Quickstart</a> &raquo;</li>
        
      <li>Quickstart (Numpy)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quickstart-numpy">
<h1>Quickstart (Numpy)<a class="headerlink" href="#quickstart-numpy" title="Permalink to this headline">¶</a></h1>
<div class="section" id="before-you-start">
<h2>Before You Start<a class="headerlink" href="#before-you-start" title="Permalink to this headline">¶</a></h2>
<p>Before jumping into this QuickStart guide, make sure you have an environment with <a class="reference external" href="https://pypi.org/project/nvflare/">NVFlare</a> installed.  You can follow
<a class="reference internal" href="../installation.html"><span class="doc">installation</span></a> on the general concept of Python virtual environment (the recommended environment) and how to
install NVFlare.</p>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This tutorial is meant to solely demonstrate how the NVFlare system works, without introducing any actual deep learning concepts.
Through this exercise, you will learn how to use NVFlare with numpy to perform basic computations across two clients.
Due to the simplified weights, you will be able to clearly see and understand the results of the FL aggregation and the model persistor process.</p>
<p>The design of this exercise consists of one <strong>server</strong> and two <strong>clients</strong>, starting with weights <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code>.
The following steps compose one cycle of weight updates, called a <strong>round</strong>:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p>Clients are responsible for adding (with some slight errors) the two weights together to calculate a Fibonacci number for the model.</p></li>
<li><p>These updates are then sent to the server which will aggregate them (averaging out the errors) to produce a model with new weights.</p></li>
<li><p>Finally, the server sends this updated version of the model back to each client, so the clients can continue to calculate the next Fibonacci number in future rounds.</p></li>
</ol>
</div></blockquote>
<p>For this exercise, we will be working with the <code class="docutils literal notranslate"><span class="pre">hello-numpy</span></code> application in the examples folder.
Every custom FL application must contain three folders:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><strong>custom</strong>: contains the custom components (<code class="docutils literal notranslate"><span class="pre">trainer.py</span></code>, <code class="docutils literal notranslate"><span class="pre">model_persistor.py</span></code>)</p></li>
<li><p><strong>config</strong>: contains client and server configurations (<code class="docutils literal notranslate"><span class="pre">config_fed_client.json</span></code>, <code class="docutils literal notranslate"><span class="pre">config_fed_server.json</span></code>)</p></li>
<li><p><strong>resources</strong>: contains the logger config (<code class="docutils literal notranslate"><span class="pre">log.config</span></code>)</p></li>
</ol>
</div></blockquote>
<p>Let’s get started. First clone the repo, if you haven’t already:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/nvidia/nvflare.git
</pre></div>
</div>
<p>Remember to activate your NVFlare Python virtual environment from the installation guide. Ensure numpy is installed.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>nvflare-env<span class="o">)</span> $ python3 -m pip install numpy
</pre></div>
</div>
<p>Now that you have all your dependencies installed, let’s implement the Federated Learning system.</p>
</div>
<div class="section" id="nvflare-client">
<h2>NVFlare Client<a class="headerlink" href="#nvflare-client" title="Permalink to this headline">¶</a></h2>
<p>In a file called <code class="docutils literal notranslate"><span class="pre">trainer.py</span></code>, import nvflare and numpy.
Now we will implement the train function to enable the clients to perform
a simple addition of two numbers to represent one calculation in the Fibonacci Sequence.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">trainer.py</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 2</span>
<span class="linenos"> 3</span><span class="kn">from</span> <span class="nn">nvflare.apis.fl_constant</span> <span class="kn">import</span> <span class="n">FLConstants</span>
<span class="linenos"> 4</span><span class="kn">from</span> <span class="nn">nvflare.apis.fl_context</span> <span class="kn">import</span> <span class="n">FLContext</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">nvflare.apis.shareable</span> <span class="kn">import</span> <span class="n">Shareable</span><span class="p">,</span> <span class="n">ShareableKey</span><span class="p">,</span> <span class="n">ShareableValue</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">nvflare.apis.trainer</span> <span class="kn">import</span> <span class="n">Trainer</span>
<span class="linenos"> 7</span>
<span class="linenos"> 8</span><span class="k">class</span> <span class="nc">SimpleTrainer</span><span class="p">(</span><span class="n">Trainer</span><span class="p">):</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span>    <span class="k">def</span> <span class="nf">train</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">shareable</span><span class="p">:</span> <span class="n">Shareable</span><span class="p">,</span> <span class="n">fl_ctx</span><span class="p">:</span> <span class="n">FLContext</span><span class="p">,</span> <span class="n">abort_signal</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Shareable</span><span class="p">:</span>
<span class="linenos">11</span>        <span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">12</span><span class="sd">        This function is an extended function from the super class.</span>
<span class="linenos">13</span><span class="sd">        As a supervised learning based trainer, the train function will run</span>
<span class="linenos">14</span><span class="sd">        evaluate and train engines based on model weights from `shareable`.</span>
<span class="linenos">15</span><span class="sd">        After the training is done, a new `Shareable` object will be submitted</span>
<span class="linenos">16</span><span class="sd">        to server for aggregation.</span>
<span class="linenos">17</span>
<span class="linenos">18</span><span class="sd">        Args:</span>
<span class="linenos">19</span><span class="sd">            shareable: the `Shareable` object received from server.</span>
<span class="linenos">20</span><span class="sd">            fl_ctx: the `FLContext` object achieved from server.</span>
<span class="linenos">21</span><span class="sd">            abort_signal: if triggered, the training will be aborted.</span>
<span class="linenos">22</span>
<span class="linenos">23</span><span class="sd">        Returns:</span>
<span class="linenos">24</span><span class="sd">            a new `Shareable` object to be submitted to server for aggregation.</span>
<span class="linenos">25</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">26</span>
<span class="linenos">27</span>        <span class="c1"># retrieve model weights download from server&#39;s shareable</span>
<span class="linenos">28</span>        <span class="n">fib</span> <span class="o">=</span> <span class="n">shareable</span><span class="p">[</span><span class="n">ShareableKey</span><span class="o">.</span><span class="n">MODEL_WEIGHTS</span><span class="p">]</span>
<span class="linenos">29</span>        <span class="n">terms</span> <span class="o">=</span> <span class="n">fib</span><span class="p">[</span><span class="s2">&quot;sequence&quot;</span><span class="p">]</span>
<span class="linenos">30</span>
<span class="linenos">31</span>        <span class="c1"># perform one step of Fibonacci </span>
<span class="linenos">32</span>        <span class="n">new_fib</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sequence&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">terms</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">terms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">terms</span><span class="p">[</span><span class="mi">1</span><span class="p">]])}</span>
<span class="linenos">33</span>
<span class="linenos">34</span>        <span class="c1"># add -1 and +1 bias for site-1 and site-2 respectively</span>
<span class="linenos">35</span>        <span class="n">client_name</span> <span class="o">=</span> <span class="n">fl_ctx</span><span class="o">.</span><span class="n">get_prop</span><span class="p">(</span><span class="n">FLConstants</span><span class="o">.</span><span class="n">CLIENT_NAME</span><span class="p">)</span>
<span class="linenos">36</span>        <span class="k">if</span> <span class="n">client_name</span> <span class="o">==</span> <span class="s2">&quot;site-1&quot;</span><span class="p">:</span>
<span class="linenos">37</span>            <span class="n">new_fib</span><span class="p">[</span><span class="s2">&quot;sequence&quot;</span><span class="p">]</span> <span class="o">-=</span> <span class="mi">1</span>
<span class="linenos">38</span>        <span class="k">elif</span> <span class="n">client_name</span> <span class="o">==</span> <span class="s2">&quot;site-2&quot;</span><span class="p">:</span>
<span class="linenos">39</span>            <span class="n">new_fib</span><span class="p">[</span><span class="s2">&quot;sequence&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="linenos">40</span>
<span class="linenos">41</span>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">client_name</span><span class="si">}</span><span class="s2"> Shareable from server: </span><span class="si">{</span><span class="n">fib</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">42</span>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">client_name</span><span class="si">}</span><span class="s2"> New Shareable to server: </span><span class="si">{</span><span class="n">new_fib</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">43</span>
<span class="linenos">44</span>        <span class="c1"># send updated weights back to server through new shareable</span>
<span class="linenos">45</span>        <span class="n">shareable</span> <span class="o">=</span> <span class="n">Shareable</span><span class="p">()</span>
<span class="linenos">46</span>        <span class="n">shareable</span><span class="p">[</span><span class="n">ShareableKey</span><span class="o">.</span><span class="n">META</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">FLConstants</span><span class="o">.</span><span class="n">NUM_STEPS_CURRENT_ROUND</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="linenos">47</span>        <span class="n">shareable</span><span class="p">[</span><span class="n">ShareableKey</span><span class="o">.</span><span class="n">TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="n">ShareableValue</span><span class="o">.</span><span class="n">TYPE_WEIGHTS</span>
<span class="linenos">48</span>        <span class="n">shareable</span><span class="p">[</span><span class="n">ShareableKey</span><span class="o">.</span><span class="n">DATA_TYPE</span><span class="p">]</span> <span class="o">=</span> <span class="n">ShareableValue</span><span class="o">.</span><span class="n">DATA_TYPE_UNENCRYPTED</span>
<span class="linenos">49</span>        <span class="n">shareable</span><span class="p">[</span><span class="n">ShareableKey</span><span class="o">.</span><span class="n">MODEL_WEIGHTS</span><span class="p">]</span> <span class="o">=</span> <span class="n">new_fib</span>
<span class="linenos">50</span>
<span class="linenos">51</span>        <span class="k">return</span> <span class="n">shareable</span>
</pre></div>
</div>
</div>
<p>The server sends either the initial weights of [0, 1] or any stored weights to each of the clients
through the <code class="docutils literal notranslate"><span class="pre">Shareable</span></code> object passed into <code class="docutils literal notranslate"><span class="pre">train()</span></code>. Each client adds the
two numbers together, and creates a new <code class="docutils literal notranslate"><span class="pre">Shareable</span></code> to include the sum of the two
numbers as well as the second number of original shareable.
This represents the calculation of one term in the Fibonacci Sequence:</p>
<p><code class="docutils literal notranslate"><span class="pre">[a,</span> <span class="pre">b]</span> <span class="pre">=&gt;</span> <span class="pre">[b,</span> <span class="pre">a</span> <span class="pre">+</span> <span class="pre">b]</span></code>
wherein <code class="docutils literal notranslate"><span class="pre">a</span></code> and <code class="docutils literal notranslate"><span class="pre">b</span></code> are two consecutive Fibonacci numbers, with <code class="docutils literal notranslate"><span class="pre">b</span> <span class="pre">&gt;</span> <span class="pre">a</span></code>.</p>
<p>In a real federated learning training scenario, each client does its training independently on its own dataset.
As such, the weights returned to the server will likely be different for each of the clients.
Because this exercise is simply doing an addition operation rather than a training on a dataset, we
<strong>hard-code</strong> a slight variation in the clients’ addition to demonstrate how the server aggregation works.
We define that client-1 always <strong>subtracts</strong> one extra from every element, while client-2 always
<strong>adds</strong> one extra to every element.</p>
<p>Fortunately, because this is a FL system with two clients, the server can <code class="docutils literal notranslate"><span class="pre">aggregrate</span></code>
(in this case average) the clients’ results to produce the correct Fibonacci number.</p>
<p>You can learn more about <code class="docutils literal notranslate"><span class="pre">Shareable</span></code> and <code class="docutils literal notranslate"><span class="pre">FLContext</span></code> in the <a class="reference internal" href="hello_pt.html"><span class="doc">Quickstart (PyTorch)</span></a> exercise or in the <a class="reference internal" href="../programming_guide.html#key-objects"><span class="std std-ref">documentation</span></a>.</p>
</div>
<div class="section" id="nvflare-server-application">
<h2>NVFlare Server &amp; Application<a class="headerlink" href="#nvflare-server-application" title="Permalink to this headline">¶</a></h2>
<div class="section" id="model-persistor">
<h3>Model Persistor<a class="headerlink" href="#model-persistor" title="Permalink to this headline">¶</a></h3>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">model_persistor.py</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">import</span> <span class="nn">os</span>
<span class="linenos"> 2</span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="linenos"> 3</span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="linenos"> 4</span>
<span class="linenos"> 5</span><span class="kn">from</span> <span class="nn">nvflare.apis</span> <span class="kn">import</span> <span class="n">Model</span><span class="p">,</span> <span class="n">ModelPersistor</span>
<span class="linenos"> 6</span><span class="kn">from</span> <span class="nn">nvflare.apis.fl_context</span> <span class="kn">import</span> <span class="n">FLContext</span>
<span class="linenos"> 7</span><span class="kn">from</span> <span class="nn">nvflare.apis.fl_constant</span> <span class="kn">import</span> <span class="n">FLConstants</span>
<span class="linenos"> 8</span>
<span class="linenos"> 9</span>
<span class="linenos">10</span><span class="k">class</span> <span class="nc">NumpyModelPersistor</span><span class="p">(</span><span class="n">ModelPersistor</span><span class="p">):</span>
<span class="linenos">11</span>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">save_name</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="linenos">12</span>        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<span class="linenos">13</span>        <span class="bp">self</span><span class="o">.</span><span class="n">save_name</span> <span class="o">=</span> <span class="n">save_name</span>
<span class="linenos">14</span>
<span class="linenos">15</span>    <span class="k">def</span> <span class="nf">_initialize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fl_ctx</span><span class="p">:</span> <span class="n">FLContext</span><span class="p">):</span>
<span class="linenos">16</span>        <span class="c1"># get save path from FLContext</span>
<span class="linenos">17</span>        <span class="n">train_root</span> <span class="o">=</span> <span class="n">fl_ctx</span><span class="o">.</span><span class="n">get_prop</span><span class="p">(</span><span class="n">FLConstants</span><span class="o">.</span><span class="n">TRAIN_ROOT</span><span class="p">)</span>
<span class="linenos">18</span>        <span class="n">log_dir</span> <span class="o">=</span> <span class="n">fl_ctx</span><span class="o">.</span><span class="n">get_prop</span><span class="p">(</span><span class="n">FLConstants</span><span class="o">.</span><span class="n">LOG_DIR</span><span class="p">)</span>
<span class="linenos">19</span>        <span class="k">if</span> <span class="n">log_dir</span><span class="p">:</span>
<span class="linenos">20</span>            <span class="bp">self</span><span class="o">.</span><span class="n">log_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">train_root</span><span class="p">,</span> <span class="n">log_dir</span><span class="p">)</span>
<span class="linenos">21</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">22</span>            <span class="bp">self</span><span class="o">.</span><span class="n">log_dir</span> <span class="o">=</span> <span class="n">train_root</span>
<span class="linenos">23</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_pkl_save_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_dir</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">save_name</span><span class="p">)</span>
<span class="linenos">24</span>        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_dir</span><span class="p">):</span>
<span class="linenos">25</span>            <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">log_dir</span><span class="p">)</span>
<span class="linenos">26</span>
<span class="linenos">27</span>    <span class="k">def</span> <span class="nf">load_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fl_ctx</span><span class="p">:</span> <span class="n">FLContext</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Model</span><span class="p">:</span>
<span class="linenos">28</span>        <span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">29</span><span class="sd">            initialize and load the Model.</span>
<span class="linenos">30</span>
<span class="linenos">31</span><span class="sd">        Args:</span>
<span class="linenos">32</span><span class="sd">            fl_ctx: FLContext</span>
<span class="linenos">33</span>
<span class="linenos">34</span><span class="sd">        Returns:</span>
<span class="linenos">35</span><span class="sd">            Model object</span>
<span class="linenos">36</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">37</span>        <span class="bp">self</span><span class="o">.</span><span class="n">_initialize</span><span class="p">(</span><span class="n">fl_ctx</span><span class="p">)</span>
<span class="linenos">38</span>
<span class="linenos">39</span>        <span class="n">model</span> <span class="o">=</span> <span class="n">Model</span><span class="p">()</span>
<span class="linenos">40</span>        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pkl_save_path</span><span class="p">):</span>
<span class="linenos">41</span>            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pkl_save_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="linenos">42</span>                <span class="n">d</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="linenos">43</span>                <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading server weights: </span><span class="si">{</span><span class="n">d</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">44</span>            <span class="n">model</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
<span class="linenos">45</span>        <span class="k">else</span><span class="p">:</span>
<span class="linenos">46</span>            <span class="n">model</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;sequence&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])}</span>
<span class="linenos">47</span>        <span class="k">return</span> <span class="n">model</span>
<span class="linenos">48</span>
<span class="linenos">49</span>    <span class="k">def</span> <span class="nf">save_model</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">fl_ctx</span><span class="p">:</span> <span class="n">FLContext</span><span class="p">):</span>
<span class="linenos">50</span>        <span class="sd">&quot;&quot;&quot;</span>
<span class="linenos">51</span><span class="sd">            persist the Model object</span>
<span class="linenos">52</span>
<span class="linenos">53</span><span class="sd">        Args:</span>
<span class="linenos">54</span><span class="sd">            model: Model object</span>
<span class="linenos">55</span><span class="sd">            fl_ctx: FLContext</span>
<span class="linenos">56</span><span class="sd">        &quot;&quot;&quot;</span>
<span class="linenos">57</span>        <span class="bp">self</span><span class="o">.</span><span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Saving aggregated server weights: </span><span class="si">{</span><span class="n">model</span><span class="si">}</span><span class="s2"> </span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="linenos">58</span>        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_pkl_save_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
<span class="linenos">59</span>            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>The model persistor is used to load and save models on the server. Here, the model is a <code class="docutils literal notranslate"><span class="pre">Model</span></code> object containing two calculated Fibonacci numbers.</p>
<p>The expected format of the <code class="docutils literal notranslate"><span class="pre">Model</span></code> object is a dictionary with keys of type <code class="docutils literal notranslate"><span class="pre">str</span></code> and values of type <code class="docutils literal notranslate"><span class="pre">numpy.array</span></code>.
This can be easily changed as long as all of the FL components agree on the format.</p>
<p>In this exercise, we can simply serialize the model dictionary using pickle and save it to weights.pickle
inside the <code class="docutils literal notranslate"><span class="pre">server/run_1/mmar_server/models/</span></code> directory (weights file name specified in <code class="docutils literal notranslate"><span class="pre">config_fed_client.json</span></code>).
Depending on the frameworks and tools, the methods of saving the model may vary.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that in our hello-examples, we are demonstrating Federated Learning using the familiar deep learning model concept.</p>
<p>However, Federated Learning is not restricted to just deep learning and may not always involve models. Thus,
we define a <a class="reference internal" href="../programming_guide.html#learnable"><span class="std std-ref">Learnable</span></a> object (subclasses <code class="docutils literal notranslate"><span class="pre">dict</span></code>) as the most general form of data object generated through Federated Learning.
The <code class="docutils literal notranslate"><span class="pre">Model</span></code> class we are using here is simply a subclass of <code class="docutils literal notranslate"><span class="pre">Learnable</span></code>.</p>
</div>
</div>
<div class="section" id="application-configuration">
<h3>Application Configuration<a class="headerlink" href="#application-configuration" title="Permalink to this headline">¶</a></h3>
<p>Inside the config folder there are two files, <code class="docutils literal notranslate"><span class="pre">config_fed_client.json</span></code> and <code class="docutils literal notranslate"><span class="pre">config_fed_server.json</span></code>.
For now, the default configurations are sufficient.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">config_fed_server.json</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">{</span>
<span class="linenos"> 2</span>  <span class="nt">&quot;format_version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="linenos"> 3</span>  <span class="nt">&quot;servers&quot;</span><span class="p">:</span> <span class="p">[</span>
<span class="linenos"> 4</span>    <span class="p">{</span>
<span class="linenos"> 5</span>      <span class="nt">&quot;min_num_clients&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="linenos"> 6</span>      <span class="nt">&quot;max_num_clients&quot;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span>
<span class="linenos"> 7</span>      <span class="nt">&quot;wait_after_min_clients&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span>
<span class="linenos"> 8</span>      <span class="nt">&quot;heart_beat_timeout&quot;</span><span class="p">:</span> <span class="mi">600</span><span class="p">,</span>
<span class="linenos"> 9</span>      <span class="nt">&quot;start_round&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="linenos">10</span>      <span class="nt">&quot;num_rounds&quot;</span><span class="p">:</span> <span class="mi">10</span>
<span class="linenos">11</span>    <span class="p">}</span>
<span class="linenos">12</span>  <span class="p">],</span>
<span class="linenos">13</span>  <span class="nt">&quot;aggregator&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">14</span>    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;AccumulateWeightedAggregator&quot;</span><span class="p">,</span>
<span class="linenos">15</span>    <span class="nt">&quot;args&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">16</span>      <span class="nt">&quot;aggregation_weights&quot;</span><span class="p">:</span>
<span class="linenos">17</span>        <span class="p">{</span>
<span class="linenos">18</span>          <span class="nt">&quot;site-1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="linenos">19</span>          <span class="nt">&quot;site-2&quot;</span><span class="p">:</span> <span class="mi">1</span>
<span class="linenos">20</span>        <span class="p">}</span>
<span class="linenos">21</span>    <span class="p">}</span>
<span class="linenos">22</span>  <span class="p">},</span>
<span class="linenos">23</span>  <span class="nt">&quot;outbound_filters&quot;</span><span class="p">:</span> <span class="p">[],</span>
<span class="linenos">24</span>  <span class="nt">&quot;inbound_filters&quot;</span><span class="p">:</span> <span class="p">[],</span>
<span class="linenos">25</span>  <span class="nt">&quot;persistor&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">26</span>    <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;model_persistor.NumpyModelPersistor&quot;</span><span class="p">,</span>
<span class="linenos">27</span>    <span class="nt">&quot;args&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">28</span>      <span class="nt">&quot;save_name&quot;</span><span class="p">:</span> <span class="s2">&quot;weight.pickle&quot;</span>
<span class="linenos">29</span>    <span class="p">}</span>
<span class="linenos">30</span>  <span class="p">},</span>
<span class="linenos">31</span>  <span class="nt">&quot;shareable_generator&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos">32</span>    <span class="nt">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;FullModelShareableGenerator&quot;</span>
<span class="linenos">33</span>  <span class="p">}</span>
<span class="linenos">34</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>Note that the <code class="docutils literal notranslate"><span class="pre">persistor</span></code> points to the custom <code class="docutils literal notranslate"><span class="pre">NumpyModelPersistor</span></code> with full Python module path.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">config_fed_client.json</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-json notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="p">{</span>
<span class="linenos"> 2</span>  <span class="nt">&quot;format_version&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<span class="linenos"> 3</span>  <span class="nt">&quot;platform&quot;</span><span class="p">:</span> <span class="s2">&quot;numpy&quot;</span><span class="p">,</span>
<span class="linenos"> 4</span>  <span class="nt">&quot;client&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos"> 5</span>    <span class="nt">&quot;outbound_filters&quot;</span><span class="p">:</span> <span class="p">[],</span>
<span class="linenos"> 6</span>    <span class="nt">&quot;inbound_filters&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="linenos"> 7</span>  <span class="p">},</span>
<span class="linenos"> 8</span>  <span class="nt">&quot;client_trainer&quot;</span><span class="p">:</span> <span class="p">{</span>
<span class="linenos"> 9</span>    <span class="nt">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;trainer.SimpleTrainer&quot;</span><span class="p">,</span>
<span class="linenos">10</span>    <span class="nt">&quot;args&quot;</span><span class="p">:</span> <span class="p">{}</span>
<span class="linenos">11</span>  <span class="p">},</span>
<span class="linenos">12</span>  <span class="nt">&quot;handlers&quot;</span><span class="p">:</span> <span class="p">[]</span>
<span class="linenos">13</span><span class="p">}</span>
</pre></div>
</div>
</div>
<p>Here, the <code class="docutils literal notranslate"><span class="pre">client_trainer</span></code> points to the Trainer implementation <code class="docutils literal notranslate"><span class="pre">SimpleTrainer</span></code>.</p>
</div>
</div>
<div class="section" id="federated-numpy-fibonacci">
<h2>Federated Numpy Fibonacci!<a class="headerlink" href="#federated-numpy-fibonacci" title="Permalink to this headline">¶</a></h2>
<p>Now you must set up a local environment and generate packages to simulate the server, clients, and admin.</p>
<div class="section" id="setting-up-the-application-environment">
<h3>Setting Up the Application Environment<a class="headerlink" href="#setting-up-the-application-environment" title="Permalink to this headline">¶</a></h3>
<p>This command generates a poc folder with server, one client and one admin:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ poc
</pre></div>
</div>
<p>Here we duplicate the client folder into two folders to create two clients, site-1 and site-2:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ cp -r poc/client poc/site-1
$ cp -r poc/client poc/site-2
</pre></div>
</div>
<p>Finally, we copy necessary files (the exercise codes) to a working folder:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ mkdir -p poc/admin/transfer
$ cp -rf examples/* poc/admin/transfer
</pre></div>
</div>
<p>With both the client and server ready, you can now run everything and see federated
learning in action. FL systems usually have a server and multiple clients. We
therefore have to start the server first:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ./poc/server/startup/start.sh
</pre></div>
</div>
<p>Once the server is running you can start the clients in different terminals.
Open a new terminal and start the first client:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ./poc/site-1/startup/start.sh site-1 localhost
</pre></div>
</div>
<p>Open another terminal and start the second client:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ./poc/site-2/startup/start.sh site-2 localhost
</pre></div>
</div>
<p>In one last terminal, start the admin:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ./poc/admin/startup/fl_admin.sh localhost
</pre></div>
</div>
<p>This will launch a command prompt, where you can input commands to control and monitor many aspects of
the FL process. Log in by entering <code class="docutils literal notranslate"><span class="pre">admin</span></code> for both the username and password.</p>
</div>
<div class="section" id="running-the-fl">
<h3>Running the FL<a class="headerlink" href="#running-the-fl" title="Permalink to this headline">¶</a></h3>
<p>Enter the commands below in order.  Pay close attention to what happens in each of four terminals.  You
can see the admin controls server and clients with each command.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt; upload_app hello-numpy
</pre></div>
</div>
<p>Uploads an application in the server’s registry.  This creates the application entry, populates the configuration and links the name
<code class="docutils literal notranslate"><span class="pre">hello-numpy</span></code> with such application configuration.  Later, you can control this application via this name.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt; set_run_number <span class="m">1</span>
</pre></div>
</div>
<p>Creates a workspace with the run_number on the server and all clients.  The purpose of this workspace is to isolate different runs so
the information in one particular run does not interfere with other runs.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt; deploy_app hello-numpy all
</pre></div>
</div>
<p>This will make the hello-numpy application the active one in the run_number workspace.  After the above two commands, the
server and all the clients know the hello-numpy application will reside in the <code class="docutils literal notranslate"><span class="pre">run_1</span></code> workspace.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt; start_app all
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">start_app</span></code> command instructs the NVFlare server and clients to start training with the hello-numpy application in that <code class="docutils literal notranslate"><span class="pre">run_1</span></code> workspace.</p>
<p>From time to time, you can issue <code class="docutils literal notranslate"><span class="pre">check_status</span> <span class="pre">server</span></code> in the admin client to check the entire training progress.</p>
<p>You should now see how the training does in the very first terminal (the one that started the server):</p>
</div>
<div class="section" id="understanding-the-output">
<h3>Understanding the Output<a class="headerlink" href="#understanding-the-output" title="Permalink to this headline">¶</a></h3>
<p>After starting the server and clients, you should begin to see
some outputs in each terminal tracking the progress of the fl run. If everything went as
planned, you should see that through 10 rounds, the FL system has calculated the correct
numbers in the Fibonacci Sequence: <code class="docutils literal notranslate"><span class="pre">0,</span> <span class="pre">1,</span> <span class="pre">1,</span> <span class="pre">2,</span> <span class="pre">3,</span> <span class="pre">5,</span> <span class="pre">8,</span> <span class="pre">13,</span> <span class="pre">21,</span> <span class="pre">34,</span> <span class="pre">55,</span> <span class="pre">89</span></code></p>
<p>Here are some snippets of the output that you can follow along with.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">site-1</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Get global model <span class="k">for</span> round: <span class="m">6</span>
pull_models completed. Status:True rank:0
site-1 Shareable from server:  <span class="o">{</span><span class="s1">&#39;sequence&#39;</span>: array<span class="o">([</span> <span class="m">8</span>., <span class="m">13</span>.<span class="o">])}</span>
site-1 Updated Shareable to server:  <span class="o">{</span><span class="s1">&#39;sequence&#39;</span>: array<span class="o">([</span><span class="m">12</span>., <span class="m">20</span>.<span class="o">])}</span>

Send model to server.
<span class="m">2021</span>-07-01 <span class="m">16</span>:22:28,431 - FederatedClient - INFO - Starting to push model.
<span class="m">2021</span>-07-01 <span class="m">16</span>:22:28,432 - Communicator - INFO - Send example_project at round <span class="m">6</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">site-2</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>Get global model <span class="k">for</span> round: <span class="m">6</span>
pull_models completed. Status:True rank:0
site-2 Shareable from server:  <span class="o">{</span><span class="s1">&#39;sequence&#39;</span>: array<span class="o">([</span> <span class="m">8</span>., <span class="m">13</span>.<span class="o">])}</span>
site-2 Updated Shareable to server:  <span class="o">{</span><span class="s1">&#39;sequence&#39;</span>: array<span class="o">([</span><span class="m">14</span>., <span class="m">22</span>.<span class="o">])}</span>

Send model to server.
<span class="m">2021</span>-07-01 <span class="m">16</span>:22:31,462 - FederatedClient - INFO - Starting to push model.
<span class="m">2021</span>-07-01 <span class="m">16</span>:22:31,463 - Communicator - INFO - Send example_project at round <span class="m">6</span>
</pre></div>
</div>
</div>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">server</span><a class="headerlink" href="#id7" title="Permalink to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="m">2021</span>-07-01 <span class="m">16</span>:22:38,453 - FederatedServer - INFO - &gt; aggregating: <span class="m">6</span>
<span class="m">2021</span>-07-01 <span class="m">16</span>:22:38,453 - AccumulateWeightedAggregator - INFO - aggregating <span class="m">2</span> updates at round <span class="m">6</span>
Saving aggregated server weights:  <span class="o">{</span><span class="s1">&#39;sequence&#39;</span>: array<span class="o">([</span><span class="m">13</span>., <span class="m">21</span>.<span class="o">])}</span>
</pre></div>
</div>
</div>
<p>As you can see, on round 6 both of the clients receive <code class="docutils literal notranslate"><span class="pre">[8,</span> <span class="pre">13]</span></code> from the server. However, instead of sending back <code class="docutils literal notranslate"><span class="pre">[13,</span> <span class="pre">8</span> <span class="pre">+</span> <span class="pre">13]</span> <span class="pre">=</span> <span class="pre">[13,</span> <span class="pre">21]</span></code>, due to the built in biases, site-1 sends back <code class="docutils literal notranslate"><span class="pre">[12,</span> <span class="pre">20]</span></code> and site-2 sends back <code class="docutils literal notranslate"><span class="pre">[14,</span> <span class="pre">22]</span></code> to the server.</p>
<p>Finally, through aggregating the clients’ results, the server saves the weights for round 6 with the correct sequence of <code class="docutils literal notranslate"><span class="pre">[13,</span> <span class="pre">21]</span></code>.</p>
<p>Once the fl run is complete and the server has successfully aggregrated the client’s results after all the rounds, run the following commands in the fl_admin to shutdown the system (while inputting <code class="docutils literal notranslate"><span class="pre">admin</span></code> when prompted with password):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt; shutdown client
&gt; shutdown server
&gt; bye
</pre></div>
</div>
<p>In order to stop all processes, run <code class="docutils literal notranslate"><span class="pre">./stop_fl.sh</span></code>.</p>
<p>If you want to reset the saved server weights to start from <code class="docutils literal notranslate"><span class="pre">[0,1]</span></code> again, delete <code class="docutils literal notranslate"><span class="pre">weights.pickle</span></code> in the <code class="docutils literal notranslate"><span class="pre">server/run_1/mmar_server/models/</span></code> directory.</p>
<p>Congratulations!
You’ve successfully built and run your first numpy federated learning system.
You now have a decent grasp of the main FL concepts, and are ready to start exploring how NVFlare can be applied to many other tasks.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="hello_tf2.html" class="btn btn-neutral float-right" title="Quickstart (TensorFlow 2)" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="hello_pt.html" class="btn btn-neutral float-left" title="Quickstart (PyTorch)" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, NVIDIA.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
  a:link, a:visited {
    color: #76b900;
  }

  a:hover {
    color: #8c0;
  }

  p {
    margin-bottom: 1em;
  }

  .rst-content dl dt {
    font-weight: unset;
    margin-bottom: 0;
  }

  .rst-content .section ul p {
    margin-bottom: 0px;
  }
  </style>
  

</body>
</html>