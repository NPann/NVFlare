<!--
# Copyright (c) 2020, NVIDIA CORPORATION. All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
#  * Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
#  * Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
#  * Neither the name of NVIDIA CORPORATION nor the names of its
#    contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY
# EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
# PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
# CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
# EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
# PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
# PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
# OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Quickstart (Numpy - Cross Site Validation) &mdash; NVIDIA FLARE 2.0 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/additions.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
           

          
            <a href="../index.html" class="icon icon-home"> NVIDIA FLARE
          

          
          </a>

          
            
            
              <div class="version">
                2.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #76b900;
    }

    .wy-side-nav-search a:link, .wy-nav-top a:link {
      color: #fff;
    }
    .wy-side-nav-search a:visited, .wy-nav-top a:visited {
      color: #fff;
    }
    .wy-side-nav-search a:hover, .wy-nav-top a:hover {
      color: #fff;
    }

    .wy-menu-vertical a:link, .wy-menu-vertical a:visited {
      color: #d9d9d9
    }

    .wy-menu-vertical a:active {
      background-color: #76b900
    }

    .wy-side-nav-search>div.version {
      color: rgba(0, 0, 0, 0.3)
    }

    .wy-nav-content {
      max-width: 80%;
    }

    .floatleftcol {
      float: left;
      max-width: 60%;
      padding-right: 20px;
    }
  </style>
  
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user_guide.html">User Guide - Provision, Start, Operate</a></li>
<li class="toctree-l1"><a class="reference internal" href="../programming_guide.html">Programming Guide - Developing Apps with NVIDIA FLARE</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apidocs/modules.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NVIDIA FLARE</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
      <li>Quickstart (Numpy - Cross Site Validation)</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/examples/hello_cross_val.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="quickstart-numpy-cross-site-validation">
<h1>Quickstart (Numpy - Cross Site Validation)<a class="headerlink" href="#quickstart-numpy-cross-site-validation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="before-you-start">
<h2>Before You Start<a class="headerlink" href="#before-you-start" title="Permalink to this headline">¶</a></h2>
<p>Before jumping into this QuickStart guide, make sure you have an environment with <a class="reference external" href="https://pypi.org/project/nvflare/">NVIDIA FLARE</a> installed.  You can follow the
<a class="reference internal" href="../installation.html"><span class="doc">installation</span></a> guide on the general concept of Python virtual environment (the recommended environment) and how to
install NVIDIA FLARE.</p>
</div>
<div class="section" id="prerequisite">
<h2>Prerequisite<a class="headerlink" href="#prerequisite" title="Permalink to this headline">¶</a></h2>
<p>This example builds on the <a class="reference internal" href="hello_numpy.html"><span class="doc">Hello Numpy</span></a> example. Please make sure you go through it completely as the concepts are heavily tied.</p>
</div>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>This tutorial is meant to solely demonstrate how the NVIDIA FLARE system works, without introducing any actual deep learning concepts.
Through this exercise, you will learn how to use NVIDIA FLARE with numpy to perform cross site validation after training. The training process is explained in the <a class="reference internal" href="hello_numpy.html"><span class="doc">Hello Numpy</span></a> example.
Using simplified weights and metrics, you will be able to clearly see how NVIDIA FLARE performs validation across different sites with little extra work.</p>
<p>The design of this exercise follows on the <a class="reference internal" href="hello_numpy.html"><span class="doc">Hello Numpy</span></a> example which consists of one <strong>server</strong> and two <strong>clients</strong>, starting with weights <code class="docutils literal notranslate"><span class="pre">[0,</span> <span class="pre">1]</span></code>. For the purpose of this basic example, we’ll consider the Fibonacci array as our local model. Cross site validation consists of the following steps:</p>
<p>During training:</p>
<ol class="arabic simple">
<li><p>Trainer must save a local model to disk.</p></li>
<li><p>Trainer must register this local model for validation using MLModelRegistry (explained later).</p></li>
<li><p>Server must register any models during training (explained later).</p></li>
</ol>
<p>Cross site validation:</p>
<ol class="arabic simple">
<li><p>Client retrieves the local model from MLModelRegistry and submits it to the server.</p></li>
<li><p>Client then asks the server for models to validate.</p></li>
<li><p>Server finds the list of models this client should validate.</p></li>
<li><p>Server sends one of these models to the client along with a flag <em>more_models_available</em>.</p></li>
<li><p>Client validates the received model from server and submits the results.</p></li>
<li><p>Client checks the <em>more_models_available</em> flag and decides if another request should be sent or cross validation should be finished.</p></li>
</ol>
<p>During this exercise, we will see how NVIDIA FLARE takes care of most of the above steps with little work from the user. We will be working with the <code class="docutils literal notranslate"><span class="pre">hello-numpy-cross-val</span></code> application in the examples folder. Every custom FL application must contain three folders:</p>
<blockquote>
<div><ol class="arabic simple">
<li><p><strong>custom</strong>: contains the custom components (<code class="docutils literal notranslate"><span class="pre">trainer.py</span></code>, <code class="docutils literal notranslate"><span class="pre">model_persistor.py</span></code>, <code class="docutils literal notranslate"><span class="pre">validator.py</span></code>)</p></li>
<li><p><strong>config</strong>: contains client and server configurations (<code class="docutils literal notranslate"><span class="pre">config_fed_client.json</span></code>, <code class="docutils literal notranslate"><span class="pre">config_fed_server.json</span></code>)</p></li>
<li><p><strong>resources</strong>: contains the logger config (<code class="docutils literal notranslate"><span class="pre">log.config</span></code>)</p></li>
</ol>
</div></blockquote>
<p>Let’s get started. First clone the repo, if you haven’t already:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ git clone https://github.com/nvidia/nvflare.git
</pre></div>
</div>
<p>Remember to activate your NVIDIA FLARE Python virtual environment from the installation guide. Ensure numpy is installed.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="o">(</span>nvflare-env<span class="o">)</span> $ python3 -m pip install numpy
</pre></div>
</div>
<p>Now that you have all your dependencies installed, let’s implement the Federated Learning system.</p>
</div>
<div class="section" id="register-mlmodel-during-training">
<h2>Register MLModel during training<a class="headerlink" href="#register-mlmodel-during-training" title="Permalink to this headline">¶</a></h2>
<p>In the <a class="reference internal" href="hello_numpy.html"><span class="doc">Hello Numpy</span></a> example, we implemented the <code class="docutils literal notranslate"><span class="pre">Trainer</span></code> object that calculates a
new sequence to submit to the server. For this example, we will consider this new sequence as this
client’s local model. In order to get our model validated on other client’s data, first, we must register
it during training.</p>
<p>Let’s take a look at the above code in <em>trainer.py</em>. First, we must save a model to disk so that it
can be used later. In this example, we simply save the numpy array as a <em>.npz</em> file. In a real application,
this could be a ML model.</p>
<p>Then, we need to register this model for cross site validation. The <em>fl_ctx</em> contains the <code class="docutils literal notranslate"><span class="pre">MLModelRegistry</span></code>.
This is a shared register for keeping track of the model between training and validation. Training produces the
model and adds to the register while validation retrieves the model. An entry in the register is denoted by <code class="docutils literal notranslate"><span class="pre">MLModelEntry</span></code>
which consists of name, meta dict and files dict. Validation will look for a model entry with key <code class="docutils literal notranslate"><span class="pre">MLModelKeys.LOCAL_BEST_MODEL</span></code>.
As you can see in the example, trainer registers the numpy array it saved using the <strong>LOCAL_BEST_MODEL</strong> key.</p>
<p>You can learn more about <code class="docutils literal notranslate"><span class="pre">Shareable</span></code> and <code class="docutils literal notranslate"><span class="pre">FLContext</span></code> in the <a class="reference internal" href="hello_pt.html"><span class="doc">Quickstart (PyTorch)</span></a> exercise or in the <a class="reference internal" href="../programming_guide.html#programming-guide"><span class="std std-ref">documentation</span></a>.</p>
<p>Note that the server also produces a global model. We can register it for cross site validation similar
to client. This is done in <em>model_persistor.py</em> as this is the component responsible for saving the model.</p>
</div>
<div class="section" id="implementing-the-validator">
<h2>Implementing the Validator<a class="headerlink" href="#implementing-the-validator" title="Permalink to this headline">¶</a></h2>
<p>The validator is responsible for validating the models received from the server. These models could
be from other clients or models generated on server.</p>
<p>The validator implements the <strong>validate</strong> function which receives a shareable. The shareable
contains two important keys:</p>
<ol class="arabic simple">
<li><p><strong>ShareableKey.DATA</strong>: This contains the dict of files for a model. These are the same files that</p></li>
<li><p>were added to MLModelEntry with <code class="docutils literal notranslate"><span class="pre">add_files()</span></code>.</p></li>
<li><p><strong>ShareableKey.META</strong>: This contains the meta data for a model. This is the same metadata added</p></li>
<li><p>to the MLModelEntry with <code class="docutils literal notranslate"><span class="pre">add_meta_data()</span></code>.</p></li>
</ol>
<p>To validate the model, the common steps are :</p>
<ol class="arabic simple">
<li><p>Retreive the model files from shareable (using <strong>ShareableKey.DATA</strong>)</p></li>
<li><p>Load the model from the files (user implementation)</p></li>
<li><p>Validate the model (user implementation)</p></li>
<li><p>Return the results in a shareable to server.</p></li>
</ol>
<p>The shareable that needs to be returned must be of <strong>TYPE_METRICS</strong>. Metrics are added using
<strong>ShareableKey.METRICS</strong> key.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that in our hello-examples, we are demonstrating Federated Learning using the familiar deep learning model concept.</p>
<p>However, Federated Learning is not restricted to just deep learning and may not always involve models. Thus,
we define a <span class="xref std std-ref">Learnable</span> object (subclasses <code class="docutils literal notranslate"><span class="pre">dict</span></code>) as the most general form of data object generated through Federated Learning.
The <code class="docutils literal notranslate"><span class="pre">Model</span></code> class we are using here is simply a subclass of <code class="docutils literal notranslate"><span class="pre">Learnable</span></code>.</p>
</div>
<div class="section" id="application-configuration">
<h3>Application Configuration<a class="headerlink" href="#application-configuration" title="Permalink to this headline">¶</a></h3>
<p>Inside the config folder there are two files, <code class="docutils literal notranslate"><span class="pre">config_fed_client.json</span></code> and <code class="docutils literal notranslate"><span class="pre">config_fed_server.json</span></code>.
By default, cross site validation is disabled. In order to enable it, the following configuration needs to be added</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">config_fed_client.json</span><a class="headerlink" href="#id1" title="Permalink to this code">¶</a></div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span>    <span class="p">},</span>
    <span class="p">{</span>
      <span class="s2">&quot;tasks&quot;</span><span class="p">:</span> <span class="p">[</span>
        <span class="s2">&quot;validate&quot;</span>
      <span class="p">],</span>
      <span class="s2">&quot;executor&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;path&quot;</span><span class="p">:</span> <span class="s2">&quot;np_validator.NPValidator&quot;</span>
      <span class="p">}</span>
    <span class="p">}</span>
  <span class="p">],</span>
</pre></div>
</div>
</div>
<p>The key settings are:</p>
<ol class="arabic simple">
<li><p><strong>cross_validate</strong>: This flag turns cross validation workflow ON or OFF. The workflow includes sharing own local model &amp; validating other models.</p></li>
<li><p><strong>cross_site_validation</strong>: This configuration defines the workflow parameters.</p></li>
<li><p><strong>is_participating</strong>: If True, client shares their local model with server. If false, client does not share their model.</p></li>
<li><p><strong>validator</strong>: Defines the validator to run validation.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that if cross site validation workflow is enabled, the client will always validate models from other sources.</p>
</div>
</div>
</div>
<div class="section" id="cross-site-validation">
<h2>Cross site validation!<a class="headerlink" href="#cross-site-validation" title="Permalink to this headline">¶</a></h2>
<p>Now you must set up a local environment and generate packages to simulate the server, clients, and admin. The steps to set up and run this application are identical to the <a class="reference internal" href="hello_numpy.html"><span class="doc">Hello Numpy</span></a> example except the app is now <code class="docutils literal notranslate"><span class="pre">hello-numpy-cross-val</span></code> instead of <code class="docutils literal notranslate"><span class="pre">hello-numpy</span></code>.</p>
<div class="section" id="setting-up-the-application-environment">
<h3>Setting Up the Application Environment<a class="headerlink" href="#setting-up-the-application-environment" title="Permalink to this headline">¶</a></h3>
<p>This command generates a poc folder with server, one client and one admin:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ poc
</pre></div>
</div>
<p>Here we duplicate the client folder into two folders to create two clients, site-1 and site-2:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ cp -r poc/client poc/site-1
$ cp -r poc/client poc/site-2
</pre></div>
</div>
<p>Finally, we copy necessary files (the exercise codes) to a working folder:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ mkdir -p poc/admin/transfer
$ cp -rf examples/* poc/admin/transfer
</pre></div>
</div>
<p>With both the client and server ready, you can now run everything and see federated
learning in action. FL systems usually have a server and multiple clients. We
therefore have to start the server first:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ./poc/server/startup/start.sh
</pre></div>
</div>
<p>Once the server is running you can start the clients in different terminals.
Open a new terminal and start the first client:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ./poc/site-1/startup/start.sh site-1 localhost
</pre></div>
</div>
<p>Open another terminal and start the second client:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ./poc/site-2/startup/start.sh site-2 localhost
</pre></div>
</div>
<p>In one last terminal, start the admin:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>$ ./poc/admin/startup/fl_admin.sh localhost
</pre></div>
</div>
<p>This will launch a command prompt, where you can input commands to control and monitor many aspects of
the FL process. Log in by entering <code class="docutils literal notranslate"><span class="pre">admin</span></code> for both the username and password.</p>
</div>
<div class="section" id="running-the-fl">
<h3>Running the FL<a class="headerlink" href="#running-the-fl" title="Permalink to this headline">¶</a></h3>
<p>Enter the commands below in order.  Pay close attention to what happens in each of four terminals.  You
can see the admin controls server and clients with each command.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt; upload_app hello-numpy-cross-val
</pre></div>
</div>
<p>Uploads an application in the server’s registry.  This creates the application entry, populates the configuration and links the name
<code class="docutils literal notranslate"><span class="pre">hello-numpy-cross-val</span></code> with such application configuration.  Later, you can control this application via this name.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt; set_run_number <span class="m">1</span>
</pre></div>
</div>
<p>Creates a workspace with the run_number on the server and all clients.  The purpose of this workspace is to isolate different runs so
the information in one particular run does not interfere with other runs.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt; deploy_app hello-numpy-cross-val all
</pre></div>
</div>
<p>This will make the hello-numpy-cross-val application the active one in the run_number workspace.  After the above two commands, the
server and all the clients know the hello-numpy-cross-val application will reside in the <code class="docutils literal notranslate"><span class="pre">run_1</span></code> workspace.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt; start_app all
</pre></div>
</div>
<p>This <code class="docutils literal notranslate"><span class="pre">start_app</span></code> command instructs the NVIDIA FLARE server and clients to start training with the hello-numpy-cross-val application in that <code class="docutils literal notranslate"><span class="pre">run_1</span></code> workspace.</p>
<p>From time to time, you can issue <code class="docutils literal notranslate"><span class="pre">check_status</span> <span class="pre">server</span></code> in the admin client to check the entire training progress. During the first phase,
the model will be trained. During the second phase, cross site validation will happen. The status of each
client will change to cross site validation as it enters this second phase.</p>
</div>
</div>
<div class="section" id="accessing-the-results">
<h2>Accessing the results<a class="headerlink" href="#accessing-the-results" title="Permalink to this headline">¶</a></h2>
<p>During cross site validation, every client validates other clients’ models and server models (if present).
This can produce a lot of results. All the results are kept on the server in
<em>&lt;run_dir&gt;/cross_val_results.json</em>. All the models sent to the server are also present in the
<em>&lt;run_dir&gt;/&lt;client_uid&gt;/</em> directory. To access results using fl_admin, please run:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt; validate &lt;data_client&gt; &lt;model_client&gt;
</pre></div>
</div>
<p>OR</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt; validate all
</pre></div>
</div>
<p>The results will be in the json format.</p>
<div class="section" id="understanding-the-output">
<h3>Understanding the Output<a class="headerlink" href="#understanding-the-output" title="Permalink to this headline">¶</a></h3>
<p>After starting the server and clients, you should begin to see
some outputs in each terminal tracking the progress of the FL run.
As each client finishes training, it will start the cross site validation process.
Druing this you’ll see several important outputs the track the progress
of cross site validation.</p>
<p>Let’s see the progress of cross site validation using output snippets. When
cross site validation begins, you should see the following prompt on client side.
This mentions the timeout (max time to wait without receiving models from server)
and the response of server for submitting client’s own local model.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">site-1</span><a class="headerlink" href="#id2" title="Permalink to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="m">2021</span>-08-29 <span class="m">15</span>:05:32,312 - CrossSiteValManager - INFO - Cross validation timeout is <span class="nb">set</span> to <span class="m">10</span> minutes.
<span class="m">2021</span>-08-29 <span class="m">15</span>:05:32,351 - Communicator - INFO - Server reply to SubmitBestLocalModel:  Received best model from site-1.. SubmitBestLocalModel time: <span class="m">0</span>.014548540115356445 seconds
</pre></div>
</div>
</div>
<p>Now the client will start asking server for models. One scenario could be that
server has no models currently available. In that case, server will ask client to wait
until more models are available. The output will look like</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">site-2</span><a class="headerlink" href="#id3" title="Permalink to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="m">2021</span>-08-29 <span class="m">15</span>:05:32,364 - FederatedClient - INFO - Getting other models from server <span class="k">for</span> cross validation.
<span class="m">2021</span>-08-29 <span class="m">15</span>:05:32,377 - Communicator - INFO - Received <span class="m">0</span> models <span class="k">for</span> validation. GetValidationModels time: <span class="m">0</span>.012315750122070312 seconds
<span class="m">2021</span>-08-29 <span class="m">15</span>:05:32,382 - FederatedClient - INFO - Server has no models available currently. Waiting <span class="m">60</span> secs before asking again.
</pre></div>
</div>
</div>
<p>Another scenario is that the server has models available. In this case, client will receive the model and
send it to validator. After validation, the results will be sent back to the server. Client output
will look something like</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">server</span><a class="headerlink" href="#id4" title="Permalink to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="m">2021</span>-08-29 <span class="m">15</span>:06:32,451 - FederatedClient - INFO - Getting other models from server <span class="k">for</span> cross validation.
<span class="m">2021</span>-08-29 <span class="m">15</span>:06:32,468 - Communicator - INFO - Received <span class="m">1</span> models <span class="k">for</span> validation. GetValidationModels time: <span class="m">0</span>.014800786972045898 seconds
<span class="m">2021</span>-08-29 <span class="m">15</span>:06:32,495 - SimpleValidator - INFO - Numpy model loaded from shareable: <span class="o">[</span><span class="m">54</span>. <span class="m">88</span>.<span class="o">]</span>
<span class="m">2021</span>-08-29 <span class="m">15</span>:06:32,495 - SimpleValidator - INFO - Metadata received with model: <span class="o">{</span><span class="s1">&#39;cookie&#39;</span>: <span class="o">{</span><span class="s1">&#39;cross_val_model_owner&#39;</span>: <span class="s1">&#39;site-1&#39;</span><span class="o">}}</span>
<span class="m">2021</span>-08-29 <span class="m">15</span>:06:32,496 - SimpleValidator - INFO - Validating the model.
<span class="m">2021</span>-08-29 <span class="m">15</span>:06:32,497 - FederatedClient - INFO - Submitting cross validation results to server.
<span class="m">2021</span>-08-29 <span class="m">15</span>:06:32,513 - Communicator - INFO - Received comments:  Received Cross Validation results from site-1.. SubmitCrossSiteValidationResults time: <span class="m">0</span>.014247655868530273 seconds
</pre></div>
</div>
</div>
<p>As you can see, the client receives a shareable with Numpy array of <code class="docutils literal notranslate"><span class="pre">[54,</span> <span class="pre">88]</span></code> and meta data showing the owner of the model.
After validation the client sends the results to the server.</p>
<p>On the server side, you can see a full log of each client who requested the model and the results received.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">server</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="m">2021</span>-08-29 <span class="m">15</span>:52:47,670 - ServerCrossSiteValManager - INFO - Received best model from site-2
<span class="m">2021</span>-08-29 <span class="m">15</span>:52:47,695 - ServerCrossSiteValManager - INFO - Client site-2 requested models <span class="k">for</span> cross site validation.
<span class="m">2021</span>-08-29 <span class="m">15</span>:52:47,696 - ServerCrossSiteValManager - INFO - Sent <span class="m">1</span> out of <span class="m">2</span> models to site-2. Will be asked to <span class="nb">wait</span> and retry.
<span class="m">2021</span>-08-29 <span class="m">15</span>:52:47,697 - ServerCrossSiteValManager - INFO - Sending site-1<span class="s1">&#39;s model to site-2 for validation.</span>
<span class="s1">2021-08-29 15:52:47,737 - ServerCrossSiteValManager - INFO - site-2 submitted results of validating site-1&#39;</span>s model.
<span class="m">2021</span>-08-29 <span class="m">15</span>:52:47,738 - ServerCrossSiteValManager - INFO - New results added are: <span class="o">{</span><span class="s1">&#39;site-2&#39;</span>: <span class="o">{</span><span class="s1">&#39;site-1&#39;</span>: <span class="o">{</span><span class="s1">&#39;result&#39;</span>: <span class="o">[</span><span class="m">10</span>, <span class="m">11</span><span class="o">]}}}</span>
</pre></div>
</div>
</div>
<p>As you can see the server shows the log of each client requesting models, the models it sends and the
results received. Since the server could be responding to many clients at the same time, it may
require careful examination to make proper sense of events from the jumbled logs.</p>
<p>Once the FL run is complete and the server has successfully aggregrated the client’s results after all the rounds, and cross site validation is finished, run the following commands in the fl_admin to shutdown the system (while inputting <code class="docutils literal notranslate"><span class="pre">admin</span></code> when prompted with password):</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>&gt; shutdown client
&gt; shutdown server
&gt; bye
</pre></div>
</div>
<p>In order to stop all processes, run <code class="docutils literal notranslate"><span class="pre">./stop_fl.sh</span></code>.</p>
<p>Congratulations!
You’ve successfully run your numpy federated learning system with cross site validation.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, NVIDIA.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
  a:link, a:visited {
    color: #76b900;
  }

  a:hover {
    color: #8c0;
  }

  p {
    margin-bottom: 1em;
  }

  .rst-content dl dt {
    font-weight: unset;
    margin-bottom: 0;
  }

  .rst-content .section ul p {
    margin-bottom: 0px;
  }
  </style>
  

</body>
</html>