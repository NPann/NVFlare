<!--
# Copyright (c) 2020, NVIDIA CORPORATION. All rights reserved.
#
# Redistribution and use in source and binary forms, with or without
# modification, are permitted provided that the following conditions
# are met:
#  * Redistributions of source code must retain the above copyright
#    notice, this list of conditions and the following disclaimer.
#  * Redistributions in binary form must reproduce the above copyright
#    notice, this list of conditions and the following disclaimer in the
#    documentation and/or other materials provided with the distribution.
#  * Neither the name of NVIDIA CORPORATION nor the names of its
#    contributors may be used to endorse or promote products derived
#    from this software without specific prior written permission.
#
# THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS ``AS IS'' AND ANY
# EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
# IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
# PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT OWNER OR
# CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
# EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
# PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
# PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY
# OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
# (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
# OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Overview &mdash; NVFlare 1.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/additions.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="NVFlare Application" href="application.html" />
    <link rel="prev" title="User Guide" href="../user_guide.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
           

          
            <a href="../index.html" class="icon icon-home"> NVFlare
          

          
          </a>

          
            
            
              <div class="version">
                1.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #76b900;
    }

    .wy-side-nav-search a:link, .wy-nav-top a:link {
      color: #fff;
    }
    .wy-side-nav-search a:visited, .wy-nav-top a:visited {
      color: #fff;
    }
    .wy-side-nav-search a:hover, .wy-nav-top a:hover {
      color: #fff;
    }

    .wy-menu-vertical a:link, .wy-menu-vertical a:visited {
      color: #d9d9d9
    }

    .wy-menu-vertical a:active {
      background-color: #76b900
    }

    .wy-side-nav-search>div.version {
      color: rgba(0, 0, 0, 0.3)
    }

    .wy-nav-content {
      max-width: 80%;
    }

    .floatleftcol {
      float: left;
      max-width: 60%;
      padding-right: 20px;
    }
  </style>
  
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../quickstart.html">Quickstart</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../user_guide.html">User Guide</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Overview</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#introduction">Introduction</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#provision-start-operate">Provision - Start - Operate</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#provision">Provision</a></li>
<li class="toctree-l5"><a class="reference internal" href="#start">Start</a></li>
<li class="toctree-l5"><a class="reference internal" href="#operate">Operate</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#provision-configure-and-generate-packages-for-the-server-clients-and-admins">Provision: Configure and generate packages for the server, clients, and admins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#preparation-for-using-the-provisioning-tool">Preparation for using the provisioning tool</a></li>
<li class="toctree-l4"><a class="reference internal" href="#provisioning-a-federated-learning-project">Provisioning a federated learning project</a></li>
<li class="toctree-l4"><a class="reference internal" href="#after-generating-packages-distribute-and-extract">After generating packages: Distribute and extract</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#start-instructions-for-each-participant-to-start-running-fl-with-their-startup-kits">Start: Instructions for each participant to start running FL with their startup kits</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#federated-learning-server-server-zip">Federated learning server (server.zip)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#federated-learning-client-client-name-zip">Federated learning client ($CLIENT_NAME.zip)</a></li>
<li class="toctree-l4"><a class="reference internal" href="#federated-learning-administration-client-email-zip">Federated learning administration client ($EMAIL.zip)</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#operate-running-federated-learning-as-an-administrator">Operate: Running federated learning as an administrator</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#example-of-running-federated-learning-from-the-administration-client">Example of running federated learning from the administration client</a><ul>
<li class="toctree-l5"><a class="reference internal" href="#check-status-of-fl-server-and-fl-client">Check status of FL server and FL client</a></li>
<li class="toctree-l5"><a class="reference internal" href="#set-run-number-for-fl-training">Set run number for FL training</a></li>
<li class="toctree-l5"><a class="reference internal" href="#upload-application-from-admin-client-to-fl-server">Upload application from admin client to FL server</a></li>
<li class="toctree-l5"><a class="reference internal" href="#deploy-application-from-transfer-directory-of-fl-server-to-active-run-on-server-and-client">Deploy application from transfer directory of FL server to active run on server and client</a></li>
<li class="toctree-l5"><a class="reference internal" href="#start-training-by-starting-fl-server-and-fl-clients">Start training by starting FL server and FL clients</a></li>
<li class="toctree-l5"><a class="reference internal" href="#stopping-federated-learning-training">Stopping federated learning training</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#standard-folder-and-file-structures-for-nvflare">Standard folder and file structures for NVFlare</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#server-side-folder-and-file-structure">Server side folder and file structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#client-side-folder-and-file-structure">Client side folder and file structure</a></li>
<li class="toctree-l4"><a class="reference internal" href="#administrator-side-folder-and-file-structure">Administrator side folder and file structure</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#known-issues">Known issues</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="application.html">NVFlare Application</a></li>
<li class="toctree-l2"><a class="reference internal" href="provisioning_tool.html">Provisioning tool</a></li>
<li class="toctree-l2"><a class="reference internal" href="authorization.html">Authorization</a></li>
<li class="toctree-l2"><a class="reference internal" href="admin_commands.html">Administrator commands</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../programming_guide.html">Programming Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../apidocs/modules.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../appendix.html">Appendix</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">NVFlare</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../user_guide.html">User Guide</a> &raquo;</li>
        
      <li>Overview</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<div class="section" id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">¶</a></h2>
<p>NVFlare utilizes provisioning and admin client to reduce the amount of human coordination involved to set up a federated learning project
and provides an admin the ability to deploy the server and client configurations, start the server / clients, abort the training,
restart the training, and more. A provisioning tool can be configured to create one startup kit for each site in an encrypted package.
These packages can then be delivered to each site ready to go, streamlining the process to provision, start, and operate federated learning.</p>
<div class="section" id="provision-start-operate">
<h3>Provision - Start - Operate<a class="headerlink" href="#provision-start-operate" title="Permalink to this headline">¶</a></h3>
<div class="section" id="provision">
<h4>Provision<a class="headerlink" href="#provision" title="Permalink to this headline">¶</a></h4>
<p>Lead IT generates the packages for the server / clients / admins, protected with passwords</p>
</div>
<div class="section" id="start">
<h4>Start<a class="headerlink" href="#start" title="Permalink to this headline">¶</a></h4>
<p>Site IT each installs their own packages, starts the services, and maps the data location</p>
</div>
<div class="section" id="operate">
<h4>Operate<a class="headerlink" href="#operate" title="Permalink to this headline">¶</a></h4>
<p>Lead scientists / administrators control the federated learning process: deploy application, check statuses, start / abort / shutdown training</p>
</div>
</div>
</div>
<div class="section" id="provision-configure-and-generate-packages-for-the-server-clients-and-admins">
<h2>Provision: Configure and generate packages for the server, clients, and admins<a class="headerlink" href="#provision-configure-and-generate-packages-for-the-server-clients-and-admins" title="Permalink to this headline">¶</a></h2>
<p>One party leads the process of configuring the provisioning tool and using it to generate startup kits for each party in
the federated learning training project:</p>
<div class="section" id="preparation-for-using-the-provisioning-tool">
<h3>Preparation for using the provisioning tool<a class="headerlink" href="#preparation-for-using-the-provisioning-tool" title="Permalink to this headline">¶</a></h3>
<p>After installation <code class="docutils literal notranslate"><span class="pre">NVFlare</span></code>, provisioning tool is available via <code class="docutils literal notranslate"><span class="pre">provision</span></code> command.</p>
</div>
<div class="section" id="provisioning-a-federated-learning-project">
<h3>Provisioning a federated learning project<a class="headerlink" href="#provisioning-a-federated-learning-project" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference internal" href="provisioning_tool.html#provisioning-tool"><span class="std std-ref">Provisioning tool</span></a> page has details on the contents of the
provisioning tool. Edit the <a class="reference internal" href="provisioning_tool.html#project-yaml-file"><span class="std std-ref">Project yaml file</span></a> in the directory with the provisioning tool to meet your
project requirements, then run the startup kit with (here we assume your project.yml is in current working directory):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">provision</span> <span class="o">-</span><span class="n">p</span> <span class="n">project</span><span class="o">.</span><span class="n">yml</span>
</pre></div>
</div>
<p>A directory named “packages” containing each of the generated zip files is created where provision.py is run.
The console displays a list of zip files and their passwords. We suggest you copy the console output
and “packages” folder to a safe location. The passwords shown below are for demonstration purposes only:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Project yaml file: /home/nvflare-venv/project.yml.
┏━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━━━┓
┃ participant           ┃ org    ┃ destination               ┃ password         ┃
┡━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━━━┩
│ localhost             │ nvidia │ server.zip                │ Dby2BhwJdLKfStWl │
│ org1-a                │ org1   │ org1-a.zip                │ BlLXFKgWp0Qu28cS │
│ org1-b                │ org1   │ org1-b.zip                │ Lu6w0aCf1RhAqSlJ │
│ org2                  │ org2   │ org2.zip                  │ KdotOafkUl2ziRh5 │
│ org3                  │ org3   │ org3.zip                  │ t05cHjnd4WNSo62x │
│ admin@nvidia.com      │ nvidia │ admin@nvidia.com.zip      │ eyTrthBudD7noW1s │
│ researcher@nvidia.com │ nvidia │ researcher@nvidia.com.zip │ s52b8h9ToIRuALpx │
│ researcher@org1.com   │ org1   │ researcher@org1.com.zip   │ dmlt3ySsAeU0V9F7 │
│ researcher@org2.com   │ org2   │ researcher@org2.com.zip   │ GJS6eb410q0ijlCZ │
│ it@org2.com           │ org2   │ it@org2.com.zip           │ s3lYvaL2tqX0Wrjb │
└───────────────────────┴────────┴───────────────────────────┴──────────────────┘
</pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You can run <code class="docutils literal notranslate"><span class="pre">provision</span> <span class="pre">-n</span> <span class="pre">-p</span> <span class="pre">project.yml</span></code> to generate zip files without password protection.</p>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>For security reasons, it is recommended to send the password to each participant separately from the package itself.</p>
</div>
</div>
<div class="section" id="after-generating-packages-distribute-and-extract">
<h3>After generating packages: Distribute and extract<a class="headerlink" href="#after-generating-packages-distribute-and-extract" title="Permalink to this headline">¶</a></h3>
<p>Please let each participant know that the packages are password protected. In Ubuntu, the following command can be used
to extract the packages:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>unzip -P $PASSWORD $ZIP_FILE -d $DIRECTORY_TO_EXTRACT_TO
</pre></div>
</div>
<p>Using <code class="docutils literal notranslate"><span class="pre">-d</span> <span class="pre">$DIRECTORY_TO_EXTRACT_TO</span></code> is optional, and without it, a “startup” folder will be extracted to the current
directory the package is in. Either way, the parent folder containing this “startup” folder (<em>$DIRECTORY_TO_EXTRACT_TO</em>
if the <code class="docutils literal notranslate"><span class="pre">-d</span></code> option was used) will be the server, client, or admin client workspace root directory, and the party
running the package will need write access there.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is important that this “startup” folder is not renamed because the code relies upon this for operation. Please
note that a “transfer” directory and deployed applications will be created at the level of this “startup” folder. See the
section on <a class="reference internal" href="#standard-folder-and-file-structures-for-nvflare">Standard folder and file structures for NVFlare</a> below for more details.</p>
</div>
</div>
</div>
<div class="section" id="start-instructions-for-each-participant-to-start-running-fl-with-their-startup-kits">
<h2>Start: Instructions for each participant to start running FL with their startup kits<a class="headerlink" href="#start-instructions-for-each-participant-to-start-running-fl-with-their-startup-kits" title="Permalink to this headline">¶</a></h2>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>Please always safeguard .key files!</p>
</div>
<div class="section" id="federated-learning-server-server-zip">
<h3>Federated learning server (server.zip)<a class="headerlink" href="#federated-learning-server-server-zip" title="Permalink to this headline">¶</a></h3>
<p>One single server will coordinate the federated learning training and be the main hub all clients and administrator
clients connect to.</p>
<p>After unzipping the package server.zip, run the start.sh file from the “startup” folder you unzipped to start the server.</p>
<p>The rootCA.pem file is pointed to by “ssl_root_cert” in fed_server.json.  If you plan to move/copy it to a different place,
you will need to modify fed_server.json.  The same applies to the other two files, server.crt and server.key.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>When launching the FL server inside a docker with <code class="docutils literal notranslate"><span class="pre">docker</span> <span class="pre">run</span></code>, use <code class="docutils literal notranslate"><span class="pre">--net=host</span></code> to map hostname into that
docker instance.  In secure gRPC, FL server has to bind the hostname specified in the provisioning stage.
Always make sure that hostname is what FL server can bind to. Additionally,
the port that the server communicates on must also not be blocked by any firewalls.</p>
</div>
<p>If clients from other machines cannot connect to the server, make sure that the host name specified when generating
the startup kits in the provisioning process resolves to the correct IP. In ubuntu, an entry may need to be added to
/etc/hosts with the IP and the host name.</p>
</div>
<div class="section" id="federated-learning-client-client-name-zip">
<h3>Federated learning client ($CLIENT_NAME.zip)<a class="headerlink" href="#federated-learning-client-client-name-zip" title="Permalink to this headline">¶</a></h3>
<p>Each site participating in federated learning training is a client. Each package for a client is named after the client
name specified when provisioning the project.</p>
<p>After unzipping the package (for details see <a class="reference internal" href="#after-generating-packages-distribute-and-extract">After generating packages: Distribute and extract</a>), run <code class="docutils literal notranslate"><span class="pre">start.sh</span></code>
from the “startup” folder you unzipped to start the client.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>You need to first install NVFlare package before running the <code class="docutils literal notranslate"><span class="pre">start.sh</span></code> shell script.  NVFlare is available
on PyPi and can be installed with <code class="docutils literal notranslate"><span class="pre">python3</span> <span class="pre">-m</span> <span class="pre">pip</span> <span class="pre">install</span> <span class="pre">nvflare</span></code>.</p>
<p>Depending on the deployed application which shall start later, your environment may need some additional
Python packages.  If you haven’t installed them, do it after you install NVFlare.  NVFlare does not dictate
your deep learning environments.  It’s completely up to you to set it up.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Coordination for where to mount the data may be needed depending on where the dataset is located in the application to be deployed.</p>
</div>
<p>The rootCA.pem file is pointed to by “ssl_root_cert” in fed_client.json.  If you plan to move/copy it to a different place,
you will need to modify fed_client.json.  The same applies to the other two files, client.crt and client.key.</p>
<p>The client name in your submission to participate this federated learning project is embedded in the CN field of client
certificate, which uniquely identifies the participant. As such, please safeguard its private key, client.key.</p>
<p>When a client successfully connects to the FL server, the server and that client will both log a token confirming that
the client successfully connected:</p>
<p>Server:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">07</span> <span class="mi">03</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">49</span><span class="p">,</span><span class="mi">712</span> <span class="o">-</span> <span class="n">ClientManager</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Client</span><span class="p">:</span> <span class="n">New</span> <span class="n">client</span> <span class="n">abcd</span><span class="o">@</span><span class="mf">127.0.0.1</span> <span class="n">joined</span><span class="o">.</span> <span class="n">Sent</span> <span class="n">token</span><span class="p">:</span> <span class="n">f279157b</span><span class="o">-</span><span class="n">df8c</span><span class="o">-</span><span class="n">aa1b</span><span class="o">-</span><span class="mi">8560</span><span class="o">-</span><span class="mi">2</span><span class="n">c43efa257bc</span><span class="o">.</span>  <span class="n">Total</span> <span class="n">clients</span><span class="p">:</span> <span class="mi">1</span>
</pre></div>
</div>
<p>Client:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="mi">2020</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">07</span> <span class="mi">03</span><span class="p">:</span><span class="mi">48</span><span class="p">:</span><span class="mi">49</span><span class="p">,</span><span class="mi">713</span> <span class="o">-</span> <span class="n">FederatedClient</span> <span class="o">-</span> <span class="n">INFO</span> <span class="o">-</span> <span class="n">Successfully</span> <span class="n">registered</span> <span class="n">client</span><span class="p">:</span><span class="n">abcd</span> <span class="k">for</span> <span class="n">exampletraining</span><span class="o">.</span> <span class="n">Got</span> <span class="n">token</span><span class="p">:</span><span class="n">f279157b</span><span class="o">-</span><span class="n">df8c</span><span class="o">-</span><span class="n">aa1b</span><span class="o">-</span><span class="mi">8560</span><span class="o">-</span><span class="mi">2</span><span class="n">c43efa257bc</span>
</pre></div>
</div>
<p>If a connection cannot be made, the client will repeatedly try to connect and for each failure log:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Could</span> <span class="ow">not</span> <span class="n">connect</span> <span class="n">to</span> <span class="n">server</span><span class="o">.</span> <span class="n">Setting</span> <span class="n">flag</span> <span class="k">for</span> <span class="n">stopping</span> <span class="n">training</span><span class="o">.</span> <span class="n">failed</span> <span class="n">to</span> <span class="n">connect</span> <span class="n">to</span> <span class="nb">all</span> <span class="n">addresses</span>
</pre></div>
</div>
<p>If the server is up, you may need to troubleshoot with settings for firewall ports to make sure that the proper
permissions are in place. This could require coordination between the lead IT and site IT personnel.</p>
</div>
<div class="section" id="federated-learning-administration-client-email-zip">
<h3>Federated learning administration client ($EMAIL.zip)<a class="headerlink" href="#federated-learning-administration-client-email-zip" title="Permalink to this headline">¶</a></h3>
<p>Each admin client will be able to connect and submit commands to the server. Each admin client package is named after
the email specified when provisioning the project, and the same email will need to be entered for authentication when
the admin client is launched.</p>
<p>Install the wheel package first with:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python3</span> <span class="o">-</span><span class="n">m</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">nvflare</span>
</pre></div>
</div>
<p>After installation, you can run the <strong>fl_admin.sh</strong> file to start communicating to the FL server.
The FL server must be running and there must be a successful connection between the admin
client and the FL server in order for the admin client to start. For the prompt <strong>User Name:</strong>, enter the email that was
used for that admin client in the provisioning of the project.</p>
<p>The rootCA.pem file is pointed to by “ca_cert” in fl_admin.sh.  If you plan to move/copy it to a different place,
you will need to modify the corresponding script.  The same applies to the other two files, client.crt and client.key.</p>
<p>The email to participate this FL project is embedded in the CN field of client certificate, which uniquely identifies
the participant. As such, please safeguard its private key, client.key.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>You will need write access in the directory containing the “startup” folder because the “transfer” directory for
uploading files as well as directories created for federated learning runs will live here. For details, see
<a class="reference internal" href="#standard-folder-and-file-structures-for-nvflare">Standard folder and file structures for NVFlare</a>.</p>
</div>
</div>
</div>
<div class="section" id="operate-running-federated-learning-as-an-administrator">
<h2>Operate: Running federated learning as an administrator<a class="headerlink" href="#operate-running-federated-learning-as-an-administrator" title="Permalink to this headline">¶</a></h2>
<div class="section" id="example-of-running-federated-learning-from-the-administration-client">
<h3>Example of running federated learning from the administration client<a class="headerlink" href="#example-of-running-federated-learning-from-the-administration-client" title="Permalink to this headline">¶</a></h3>
<p>With all connections between the FL server, FL clients, and administration clients open and all of the parties
started successfully as described in the preceding section, <a class="reference internal" href="#federated-learning-administration-client-email-zip">Federated learning administration client ($EMAIL.zip)</a>,
the following is an example of a series of admin commands and their outputs to operate a federated learning project.</p>
<p>For a complete list of admin commands, see <a class="reference internal" href="admin_commands.html#administrator-commands"><span class="std std-ref">Administrator commands</span></a>.</p>
<div class="section" id="check-status-of-fl-server-and-fl-client">
<h4>Check status of FL server and FL client<a class="headerlink" href="#check-status-of-fl-server-and-fl-client" title="Permalink to this headline">¶</a></h4>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt; check_status server</span>
<span class="go">FL run number has not been set.</span>
<span class="go">FL server status: training not started</span>
<span class="go">Registered clients: 2</span>
<span class="go">client name:flclient1   instance name:flclient1     token: 53b6f87a-79f0-4127-9735-72051de2dad9</span>
<span class="go">client name:flclient2       instance name:flclient2 token: b37644d4-7910-4a11-adf9-14cd790c1151</span>

<span class="go">Done [9325 usecs] 2020-07-07 16:31:15.175153</span>

<span class="go">&gt; check_status client</span>
<span class="go">instance:flclient1 : client name: flclient1 token: 53b6f87a-79f0-4127-9735-72051de2dad9     status: training not started</span>
<span class="go">instance:flclient2 : client name: flclient2 token: b37644d4-7910-4a11-adf9-14cd790c1151     status: training not started</span>

<span class="go">Done [308172 usecs] 2020-07-07 16:31:27.300195</span>
</pre></div>
</div>
<p>The two commands above are not necessary, but check the status of the server and clients to confirm that they are registered
and that the FL server and FL client statuses are all “training not started”.</p>
<p>Please note that in the status of the server above, FL run number has not been set. Let us set a new run number next:</p>
</div>
<div class="section" id="set-run-number-for-fl-training">
<h4>Set run number for FL training<a class="headerlink" href="#set-run-number-for-fl-training" title="Permalink to this headline">¶</a></h4>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt; set_run_number 123</span>
<span class="go">Create a new run folder: run_123</span>
<span class="go">Done [8810 usecs] 2020-07-07 17:05:05.145405</span>
</pre></div>
</div>
<p>The FL run number is critical to starting and managing FL training projects because all training happens within a run.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>You must not start a new run before the previous run is finished completely.</p>
</div>
<p>After setting a run number, a folder for that run is created on the server under the root of the server’s workspace at
the same level as the startup directory (see the section on <a class="reference internal" href="#standard-folder-and-file-structures-for-nvflare">Standard folder and file structures for NVFlare</a>
below for more details). Initially, this folder will be empty when created for a new run.</p>
<p>In order to start training for a federated learning project, an application with the proper configurations needs to be uploaded
and deployed to the server and all the participating clients.</p>
</div>
<div class="section" id="upload-application-from-admin-client-to-fl-server">
<h4>Upload application from admin client to FL server<a class="headerlink" href="#upload-application-from-admin-client-to-fl-server" title="Permalink to this headline">¶</a></h4>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt; upload_app segmentation_ct_spleen</span>
<span class="go">Created folder /path_on_server/fl_server_workspace_root/startup/../transfer/segmentation_ct_spleen</span>
<span class="go">Done [962809 usecs] 2020-07-07 17:16:09.947498</span>
</pre></div>
</div>
<p>The admin command <code class="docutils literal notranslate"><span class="pre">upload_app</span></code> uploads an application from the administrator’s machine’s transfer directory to the
server’s transfer directory (both at the same level as their respective startup directories).  The administrator
can run <code class="docutils literal notranslate"><span class="pre">upload_app</span></code> either before or after <code class="docutils literal notranslate"><span class="pre">set_run_number</span></code> but in order to deploy the application for the next step,
a run number must be set:</p>
</div>
<div class="section" id="deploy-application-from-transfer-directory-of-fl-server-to-active-run-on-server-and-client">
<h4>Deploy application from transfer directory of FL server to active run on server and client<a class="headerlink" href="#deploy-application-from-transfer-directory-of-fl-server-to-active-run-on-server-and-client" title="Permalink to this headline">¶</a></h4>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt; deploy_app segmentation_ct_spleen server</span>
<span class="go">mmar_server has been deployed.</span>
<span class="go">Done [14036 usecs] 2020-07-07 17:27:21.365732</span>

<span class="go">&gt; deploy_app segmentation_ct_spleen client</span>
<span class="go">instance:flclient1 : MMAR deployed.</span>
<span class="go">instance:flclient2 : MMAR deployed.</span>

<span class="go">Done [521724 usecs] 2020-07-07 17:27:28.337640</span>
</pre></div>
</div>
<p>The two commands above deployed the specified application that had already been uploaded to the server’s transfer directory into
directories corresponding to the run number. In this case, since the run number was set to 123, the segmentation_ct_spleen
application was copied into the run_123 directory on the FL server and FL clients (see the section on <a class="reference internal" href="#standard-folder-and-file-structures-for-nvflare">Standard folder and file structures for NVFlare</a>
below for a more visual representation).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The first command deployed the application to the FL server, and the second command deployed the application to all active
FL clients. You can also choose to deploy an application to a specific client by specifying the client instance name after
the command, for example, the following would only deploy the application to flclient1: deploy_app segmentation_ct_spleen client flclient1</p>
</div>
<p>After the application is deployed to the FL server and participating FL clients, training can be started:</p>
</div>
<div class="section" id="start-training-by-starting-fl-server-and-fl-clients">
<h4>Start training by starting FL server and FL clients<a class="headerlink" href="#start-training-by-starting-fl-server-and-fl-clients" title="Permalink to this headline">¶</a></h4>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt; start_app server</span>
<span class="go">Server training is starting....</span>
<span class="go">Done [13004 usecs] 2020-07-07 13:27:37.325887</span>

<span class="go">&gt; start_app client</span>
<span class="go">instance:flclient1 : Starting the client...</span>
<span class="go">instance:flclient2 : Starting the client...</span>

<span class="go">Done [210790 usecs] 2020-07-07 13:27:46.968446</span>
</pre></div>
</div>
<p>The server status should proceed from “training not started” to “training starting” then to “training started”, and this
can be checked with the command <code class="docutils literal notranslate"><span class="pre">check_status</span> <span class="pre">server</span></code>. The clients should begin training after the server is in the
“training started” status.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The command <code class="docutils literal notranslate"><span class="pre">start_mgpu</span> <span class="pre">client</span> <span class="pre">&lt;gpu</span> <span class="pre">number&gt;</span> <span class="pre">&lt;client</span> <span class="pre">name&gt;</span></code> can be used to start multiple GPU federated learning
training on clients. Please refer to <a class="reference internal" href="../faq.html#multi-gpu-training"><span class="std std-ref">multi-gpu training</span></a>.</p>
</div>
</div>
<div class="section" id="stopping-federated-learning-training">
<h4>Stopping federated learning training<a class="headerlink" href="#stopping-federated-learning-training" title="Permalink to this headline">¶</a></h4>
<p>Do not use ctrl-c to stop the FL server or FL clients, as there are known issues that can leave clients in a state where
they are stuck and unable to communicate with the FL server. Instead the following command can be used to abort a client
to stop training</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt; abort client flclient1</span>
<span class="go">instance:flclient1 : Aborting the client...</span>

<span class="go">Done [511128 usecs] 2020-07-08 13:28:32.235777</span>
</pre></div>
</div>
<p>You can also use <code class="docutils literal notranslate"><span class="pre">abort</span> <span class="pre">client</span></code> to stop training on all clients. Please note that abort will not work unless the client
has already successfully started training.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The “Done” displayed on the admin client is referring to the message sending being done. The actual completion
of aborting the client may occur after some slight delay.</p>
</div>
<p>To then shut down the client entirely and end the FL client process</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">&gt; shutdown client flclient1</span>
<span class="go">Are you sure (Y/N): Y</span>
<span class="go">instance:flclient1 : Shutdown the client...</span>

<span class="go">Done [272239 usecs] 2020-07-08 13:33:31.377445</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">shutdown</span> <span class="pre">client</span></code> command can also be issued without a specific client to shut down all clients, and this command
requires the administrator to enter “Y” for confirmation.</p>
<p>Both <code class="docutils literal notranslate"><span class="pre">abort</span></code> and <code class="docutils literal notranslate"><span class="pre">shutdown</span></code> can be used to stop training and end the FL server process as well, with <code class="docutils literal notranslate"><span class="pre">abort</span> <span class="pre">server</span></code>
and <code class="docutils literal notranslate"><span class="pre">shutdown</span> <span class="pre">server</span></code>. Please note that you should shut down the clients before the server because the clients receive
commands through the server. If a client refuses to die, wait the duration of the heartbeat to see if it gets dropped,
then after all clients are shut down, you can shut down the server. If a client still refuses to die, IT personnel at
the site may have to kill it.</p>
</div>
</div>
</div>
<div class="section" id="standard-folder-and-file-structures-for-nvflare">
<h2>Standard folder and file structures for NVFlare<a class="headerlink" href="#standard-folder-and-file-structures-for-nvflare" title="Permalink to this headline">¶</a></h2>
<div class="section" id="server-side-folder-and-file-structure">
<h3>Server side folder and file structure<a class="headerlink" href="#server-side-folder-and-file-structure" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">some_path_on_fl_server</span><span class="o">/</span><span class="n">fl_server_workspace_root</span><span class="o">/</span>
    <span class="n">admin_audit</span><span class="o">.</span><span class="n">log</span>
    <span class="n">log</span><span class="o">.</span><span class="n">txt</span>
    <span class="n">startup</span><span class="o">/</span>
        <span class="n">authorization</span><span class="o">.</span><span class="n">json</span>
        <span class="n">fed_server</span><span class="o">.</span><span class="n">json</span>
        <span class="n">log</span><span class="o">.</span><span class="n">config</span>
        <span class="n">readme</span><span class="o">.</span><span class="n">txt</span>
        <span class="n">rootCA</span><span class="o">.</span><span class="n">pem</span>
        <span class="n">server_context</span><span class="o">.</span><span class="n">tenseal</span>
        <span class="n">server</span><span class="o">.</span><span class="n">crt</span>
        <span class="n">server</span><span class="o">.</span><span class="n">key</span>
        <span class="n">signature</span><span class="o">.</span><span class="n">pkl</span>
        <span class="n">start</span><span class="o">.</span><span class="n">sh</span>
        <span class="n">stop_fl</span><span class="o">.</span><span class="n">sh</span>
        <span class="n">sub_start</span><span class="o">.</span><span class="n">sh</span>
    <span class="n">transfer</span><span class="o">/</span>
    <span class="n">run_1</span><span class="o">/</span>
        <span class="n">mmar_server</span><span class="o">/</span>
            <span class="n">config</span><span class="o">/</span>
            <span class="n">models</span><span class="o">/</span>
            <span class="n">resources</span><span class="o">/</span>
        <span class="n">mmar_client1</span><span class="o">/</span>
            <span class="n">config</span><span class="o">/</span>
            <span class="n">models</span><span class="o">/</span>
            <span class="n">evals</span><span class="o">/</span>
            <span class="n">resources</span><span class="o">/</span>
        <span class="n">mmar_client2</span><span class="o">/</span>
            <span class="n">config</span><span class="o">/</span>
            <span class="n">models</span><span class="o">/</span>
            <span class="n">evals</span><span class="o">/</span>
            <span class="n">resources</span><span class="o">/</span>
        <span class="n">cross_validation</span><span class="o">/</span>
    <span class="n">run_2</span><span class="o">/</span>
        <span class="o">......</span>
</pre></div>
</div>
</div>
<div class="section" id="client-side-folder-and-file-structure">
<h3>Client side folder and file structure<a class="headerlink" href="#client-side-folder-and-file-structure" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">some_path_on_fl_client</span><span class="o">/</span><span class="n">fl_client_workspace_root</span><span class="o">/</span>
    <span class="n">log</span><span class="o">.</span><span class="n">txt</span>
    <span class="n">startup</span><span class="o">/</span>
        <span class="n">client_context</span><span class="o">.</span><span class="n">tenseal</span>
        <span class="n">client</span><span class="o">.</span><span class="n">crt</span>
        <span class="n">client</span><span class="o">.</span><span class="n">key</span>
        <span class="n">fed_client</span><span class="o">.</span><span class="n">json</span>
        <span class="n">log</span><span class="o">.</span><span class="n">config</span>
        <span class="n">readme</span><span class="o">.</span><span class="n">txt</span>
        <span class="n">rootCA</span><span class="o">.</span><span class="n">pem</span>
        <span class="n">signature</span><span class="o">.</span><span class="n">pkl</span>
        <span class="n">start</span><span class="o">.</span><span class="n">sh</span>
        <span class="n">stop_fl</span><span class="o">.</span><span class="n">sh</span>
        <span class="n">sub_start</span><span class="o">.</span><span class="n">sh</span>
    <span class="n">transfer</span><span class="o">/</span>
    <span class="n">run_1</span><span class="o">/</span>
        <span class="n">mmar_client1</span><span class="o">/</span>
            <span class="n">config</span><span class="o">/</span>
            <span class="n">models</span><span class="o">/</span>
            <span class="n">evals</span><span class="o">/</span>
            <span class="n">resources</span><span class="o">/</span>
    <span class="n">run_2</span><span class="o">/</span>
        <span class="n">mmar_client1</span><span class="o">/</span>
            <span class="n">config</span><span class="o">/</span>
            <span class="n">models</span><span class="o">/</span>
            <span class="n">evals</span><span class="o">/</span>
            <span class="n">resources</span><span class="o">/</span>
    <span class="n">run_3</span><span class="o">/</span>
        <span class="o">......</span>
</pre></div>
</div>
</div>
<div class="section" id="administrator-side-folder-and-file-structure">
<h3>Administrator side folder and file structure<a class="headerlink" href="#administrator-side-folder-and-file-structure" title="Permalink to this headline">¶</a></h3>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">some_path_on_fl_admin</span><span class="o">/</span><span class="n">fl_administrator_workspace_root</span><span class="o">/</span>
    <span class="n">startup</span><span class="o">/</span>
        <span class="n">client</span><span class="o">.</span><span class="n">crt</span>
        <span class="n">client</span><span class="o">.</span><span class="n">key</span>
        <span class="n">fl_admin</span><span class="o">.</span><span class="n">sh</span>
        <span class="n">readme</span><span class="o">.</span><span class="n">txt</span>
        <span class="n">rootCA</span><span class="o">.</span><span class="n">pem</span>
        <span class="n">signature</span><span class="o">.</span><span class="n">pkl</span>
    <span class="n">transfer</span><span class="o">/</span>
        <span class="n">MMAR_for_uploading</span><span class="o">/</span>
            <span class="n">config</span><span class="o">/</span>
            <span class="n">models</span><span class="o">/</span>
            <span class="n">evals</span><span class="o">/</span>
            <span class="n">resources</span><span class="o">/</span>
        <span class="n">MMAR2_for_uploading</span><span class="o">/</span>
            <span class="n">config</span><span class="o">/</span>
            <span class="n">models</span><span class="o">/</span>
            <span class="n">evals</span><span class="o">/</span>
            <span class="n">resources</span><span class="o">/</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="known-issues">
<h2>Known issues<a class="headerlink" href="#known-issues" title="Permalink to this headline">¶</a></h2>
<ol class="arabic simple">
<li><p>If server dies and then is restarted, intentionally or unintentionally, all clients will have to be restarted.</p></li>
<li><p>Running out of memory can happen at any time, especially if the server and clients are running on same machine. This
can cause the server the die unexpectedly.</p></li>
<li><p>Putting applications in the transfer folders without using the upload_app command or forgetting to delete the models folder
inside, a mysterious error may occur when running the deploy command because the application folder is too large to be uploaded
and that causes timeout.</p></li>
</ol>
</div>
</div>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="application.html" class="btn btn-neutral float-right" title="NVFlare Application" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="../user_guide.html" class="btn btn-neutral float-left" title="User Guide" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2021, NVIDIA.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    

  <style>
  a:link, a:visited {
    color: #76b900;
  }

  a:hover {
    color: #8c0;
  }

  p {
    margin-bottom: 1em;
  }

  .rst-content dl dt {
    font-weight: unset;
    margin-bottom: 0;
  }

  .rst-content .section ul p {
    margin-bottom: 0px;
  }
  </style>
  

</body>
</html>